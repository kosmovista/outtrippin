<div ng-cloak>
<% set_page_title(@itinerary.extra_info[:name].blank? ? "Trip to " + @itinerary.destination + " - OutTrippin" : @itinerary.extra_info[:name] + " - OutTrippin") %>
<div class="cover" style="background-image:url({{plan.cover}})"></div>
<div id="overlay"></div>
<div class="header">
  <div class="row">
    <div class="large-12 small-12 text-center columns">
      <h2 class="white text-center"><%= @itinerary.extra_info[:name].blank? ? "Trip to " + @itinerary.destination : @itinerary.extra_info[:name] %></h2>
      <div class="large-1 hide-for-small large-centered columns">
        <hr style="border-color:white;">
      </div>
      <h5 class="white serif subheader text-center"><em>Woot! <%= @itinerary.extra_info[:travelers] %> have selected you to write the story of their trip to <%= @itinerary.destination %>! Let's get started, then, shall we?</em></h5>
    </div>
  </div>
</div>
<div class="tabs">
  <div class="large-1 small-2 text-center large-centered small-centered columns">
    <% if (current_user && @plan.user == current_user) || current_user.admin? %>
     <label class="file-input story-cover text-center">
       <%= image_tag "edit-circle.png", style: "width:30px;", title: "Change Cover Picture" %>
       <input type="file" ng-file-select="onFileSelect($files, true, 0)">
     </label>
    <% end %>
  </div>
</div>

<ul class="days small-block-grid-1">
  <li ng-repeat="day in plan.days" id="{{day.id}}">
    <!-- DISPLAY TITLE, PARAGRAPH AND EDIT BUTTON -->
    <div ng-show="!editing" class="read">
      <div class="row">
        <div class="large-11 large-centered small-12 columns">
          <div class="large-2 small-6 columns">
            <h5 class="subheader serif"><em>Day {{$index+1}}</em></h5>
          </div>
          <div class="large-8 columns">
            <h3 style="margin-top:0;">{{day.title}}</h3>

            <div class="desc">
              <label class="file-input perday">
                <span ng-if="!day.picture"><%= image_tag "image.png", style:"width:300px; opacity:0.2;" %></span>
                <img ng-if="day.picture" ng-src="{{day.picture}}" class="day-photo"></img>
                <input type="file" ng-file-select="onFileSelect($files, false, day.id)">
              </label>
              <p ng-bind-html="day.body"></p>
            </div>
          </div>

          <div class="large-2 small-6 right columns text-right">
            <% if (current_user && @plan.user == current_user) || current_user.admin? %>
            <a href="" class="circle-button"  ng-click="editing=true;" title="Edit Day">
              <%= image_tag "edit-circle.png", style: "width:30px", class: "circle-button" %>
            </a>
            <% end %>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="large-1 small-12 large-centered columns">
          <hr>
        </div>
      </div>
    </div>
    <!-- WHILE EDITING -->
    <div ng-show="editing" class="edit">
      <div class="row">
        <div class="large-11 large-centered small-12 columns">
          <div class="row">
            <form ng-submit="editing = false" style="margin:0;">
              <div class="large-2 small-6 columns">
              </div>
              <div class="large-2 right small-6 columns text-right">
                <a href="" class="circle-button" title="Add Image"><%= image_tag "camera.png", class:"hide-for-medium-up", style:"width:25px; opacity:0.7;" %></a>
                <a href="" class="circle-button" title="Save Changes" ng-click="update_day(day.id, day.title, day.body)"><%= image_tag "save.png", style:"width:25px" %></a>
                <a href="" class="circle-button" title="Cancel" ng-click="editing=false; cancel()"><%= image_tag "cancel.png", style: "width:25px" %></a>
                <a href="" class="circle-button" title="Delete Day" ng-click="delete_day(day.id)"><%= image_tag "delete-circle.png", style: "width:25px" %></a>
              </div>
              <div class="large-8 small-12 columns">
                <h3><input type="text" autofocus="true" ng-model="day.title"></h3>
                <div class="desc" text-angular ng-model="day.body"></div>
              </div>
            </form>
          </div>
          <div class="row">
            <div class="large-1 small-12 large-centered columns">
              <hr>
            </div>
          </div>
        </div>
      </div>
    </div>
  </li>

  <!-- ADD NEW DAY -->
  <li>
    <div ng-show="add_day" class="edit">
      <div class="row">
        <form ng-submit="add_day = false" style="margin:0;">
          <div class="large-11 large-centered small-12 columns">
            <div class="large-2 small-6 columns">
              <h5 class="subheader serif"><em>Day X</em></h5>
            </div>
            <div class="large-2 right small-6 columns text-right">
              <a href="" class="circle-button" title="Add Image"><%= image_tag "camera.png", class: "hide-for-medium-up", style: "width:25px; opacity:0.7;" %></a>
              <a href="" class="circle-button" title="Cancel" ng-click="add_day=false"><%= image_tag "cancel.png", style: "width:25px" %></a>
              <a href="" class="circle-button" title="Save Day" ng-click="save_day()"><%= image_tag "save.png", style: "width:26px" %></a>
            </div>
            <div class="large-8 small-12 columns">
              <h3><input type="text" autofocus="true" ng-model="day.title" placeholder="A title for the day"/></h3>
              <div class="desc" text-angular ng-model="day.body"></div>
            </div>
          </div>
        </form>
      </div>
      <div class="row">
        <div class="large-1 small-12 large-centered columns">
          <hr>
        </div>
      </div>
    </div>
  </li>

  <li ng-repeat="tt in plan.tips_tricks" id="{{tt.id}}">
    <!-- DISPLAY TITLE, TIP AND EDIT BUTTON -->
    <div ng-show="!editing_tt">
      <div class="row">
        <div class="large-11 large-centered columns">
          <div class="large-2 right columns text-right">
            <% if (current_user && @plan.user == current_user) || current_user.admin? %>
              <a href="" class="circle-button" ng-click="editing_tt=true" title="Edit Tip"><%= image_tag "edit-circle.png", style: "width:30px;", class: "circle-button" %></a>
            <% end %>
          </div>
          <div class="large-8 large-centered columns">
            <div class="tips">
              <h4 class="subheader black serif"><em><span style="font-size:120%;">{{tt.title}}</span> {{tt.body}}</em></h4>
              <h6 class="subheader serif" style="padding-top:.8em;"><%= image_tag @plan.user.avatar.url, class: "rounded text-right tip-avatar" %><em><%= @plan.user.personal_info[:name] %></em></h6>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- WHILE EDITING TIP & TRICK -->
    <div ng-show="editing_tt" class="edit">
      <div class="row">
        <div class="large-11 large-centered columns">
          <div class="large-2 right columns text-right">
            <a href="" class="circle-button" title="Save Changes" ng-click="update_tip_trick(tt.id, tt.title, tt.body)"><%= image_tag "save.png", style:"width:25px" %></a>
            <a href="" class="circle-button" title="Cancel" ng-click="editing_tt=false;cancel();"><%= image_tag "cancel.png", style:"width:25px" %></a>
            <a href="" class="circle-button" title="Delete Tip Trick" ng-click="delete_tip_trick(tt.id)"><%= image_tag "delete-circle.png", style:"width:25px" %></a>
          </div>
          <div class="large-8 large-centered columns">
            <div class="tips">
              <h4 class="subheader black serif" ><span style="font-size:120%;"><input type="text" style="font-style:italic;" autofocus="true" ng-model="tt.title" /></span></h4>
              <h4 class="subheader black serif" ><textarea ng-model="tt.body" style="font-style:italic;"></textarea></h4>
            </div>
          </div>
        </div>
      </div>
    </div>
  </li>

  <!-- ADD NEW TIP TRICK -->
  <li>
    <div ng-show="add_tip_trick" class="edit">
      <div class="row">
        <div class="large-11 large-centered columns">
          <div class="large-2 right columns text-right">
            <a href="" class="circle-button" title="Cancel" ng-click="add_tip_trick=false"><%= image_tag "cancel.png", style: "width:25px" %></a>
            <a href="" class="circle-button" title="Save Day" ng-click="save_tip_trick()"><%= image_tag "save.png", style: "width:26px" %></a>
          </div>
          <div class="large-8 large-centered columns">
            <div class="tips">
              <form ng-submit="add_tip_trick = false" style="margin:0;">
                <h4 class="subheader black serif" >
                  <span style="font-size:120%;">
                    <input type="text" autofocus="true" style="font-style:italic;" ng-model="tip_trick.title" placeholder="A title for the tip"/>
                  </span>
                </h4>
                <h4 class="subheader black serif" >
                  <textarea style="font-style:italic;" ng-model="tip_trick.body" placeholder="Write a short description of the tip or trick."/></textarea>
                </h4>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </li>

  <!-- ADD NEW DAY/TIPS&TRICKS BUTTONS -->
  <% if (current_user && @plan.user == current_user) || current_user.admin? %>
  <li>
    <div class="row">
      <div class="large-12 text-center columns">
        <a href="" class="button radius" ng-click="add_day=true">&#43; Add Day</a>
        <a href="" class="button radius" style="margin-left:10px;" ng-click="add_tip_trick=true">&#43; Add a Tip </a>
      </div>
    </div>
  </li>
  <% end %>
</ul>
</div>